# 可插拔数据库

## 一、seed模板创建数据库

### 1. 种子模板
```
# 注意 docker 挂载路径
docker volume inspect oracle_opt
"Mountpoint": "/var/lib/docker/volumes/oracle_opt/_data"

# 利用seed种子模板创建pdb
CREATE PLUGGABLE DATABASE pdb_name          # 创建pdb数据库
    ADMIN USER admin IDENTIFIED BY 123456   # 创建pdb管理员
    STORAGE (MAXSIZE 2G)                    # 指定2g内存大小
    PATH_PREFIX = '/opt/oracle/oradata/ORCL/pdb_name/'   # 指定数据库位置
    FILE_NAME_CONVERT = ('/opt/oracle/oradata/ORCL/pdbseed/', '/opt/oracle/oradata/ORCL/pdb_name/');  # 将pdbseed模板复制到当前新创的数据库
```

### 2. 路径解释
```
# 连接oracle数据库
docker exec -it oracle bash
sqlplus / as sysdba

# 1.数据库路径解释，查看数据文件
SELECT name FROM v$datafile;
/opt/oracle/oradata/ORCL                    # CDB，这是安装oracle时自带的CDB
/opt/oracle/oradata/ORCL/ORCLPDB1           # PDB，与此同时自带的PDB
/opt/oracle/oradata/ORCL/pdbseed            # seed种子模板
/opt/oracle/oradata/ORCL/pdb_name           # 这是我们创建的新的pdb数据库

# 2.数据库配置文件解释，查看表空间：
SELECT TABLESPACE_NAME, STATUS, CONTENTS FROM DBA_TABLESPACES;  
TABLESPACE_NAME                STATUS    CONTENTS
------------------------------ --------- ---------------------
SYSTEM                         ONLINE    PERMANENT      # 系统表空间
SYSAUX                         ONLINE    PERMANENT      # 辅助表空间
UNDOTBS1                       ONLINE    UNDO           # 回退表空间
TEMP                           ONLINE    TEMPORARY      # 临时表空间
USERS                          ONLINE    PERMANENT      # 用户表空间
```

## 二、实例操作

### 1. 创建数据库
```
# 创建 pdbmovie 数据库
CREATE PLUGGABLE DATABASE pdbmovie 
    ADMIN USER movieadm IDENTIFIED BY 123456 
    STORAGE (MAXSIZE 2G) 
    PATH_PREFIX = '/opt/oracle/oradata/ORCL/pdbmovie' 
    FILE_NAME_CONVERT = ('/opt/oracle/oradata/ORCL/pdbseed/', '/opt/oracle/oradata/ORCL/pdbmovie/');

# 修改数据库状态为开放状态
alter pluggable database pdbmovie open;

# 连接数据库
sqlplus MOVIEADM/123456@//127.0.0.1:1521/pdbmovie

# 切换数据库，但不切换用户
ALTER SESSION SET CONTAINER=pdbmovie;

# 切换数据库，指定用户登录
connect movieadm/123456@//127.0.0.1:1521/pdbmovie

# 切换 SYSDBCA
connect / as sysdba

# 查看当前数据库
SELECT sys_context('USERENV', 'CON_NAME') AS pdb_name FROM dual;
```

### 2.删除数据库
```
# 关闭 pdbmovie
ALTER PLUGGABLE DATABASE pdbmovie CLOSE;

# 删除 pdbmovie 以及配置文件
DROP PLUGGABLE DATABASE pdbmovie INCLUDING DATAFILES;

# 查看 已经完美删除，但仍然残留 pdb 的空目录
show pdbs;
```
