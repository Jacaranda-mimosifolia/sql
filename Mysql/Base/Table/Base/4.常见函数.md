## 函数

### 聚合函数
```
聚合函数只能对分组后的数据组进行处理，不能用在where上。
COUNT(*)：统计行数
COUNT(col)：统计 col 非 NULL 的行数
SUM(col)：求和
AVG(col)：平均值
MAX(col)：最大值
MIN(col)：最小值

应用场景：
SELECT：生成汇总列
HAVING：按汇总结果过滤组
ORDER BY：按汇总结果排序（有 GROUP BY 时很常见）
例如：
SELECT area_id, COUNT(*) AS cnt
FROM movie_area
GROUP BY area_id
HAVING COUNT(*) >= 2
ORDER BY COUNT(*) DESC;
```

### 字符串函数
```
concat(s1,s2,...,sn)            字符串拼接
lower(str)                      小写
upper(str)                      大写
lpad(str,n,pad)                 左填充,左边填充pad,直到长度n
rpad(str,n,pad)                 右填充,右边填充pad,直到长度n
trim(str)                       掉两边空格
substring(str,start,len)        从start开始截取str的len长度
```

### 数值函数
```
ceil(x)                         向上取整
floor(x)                        向下取整
mod(x,y)                        返回x/y的模
rand()                          返回0-1的随机数
round(x,y)                      对x四舍五入,保留y位小数
```

### 日期函数
```
curdate()                           返回当前日期
curtime()                           返回当前时间
now()                               返回当前日期+时间

year(date)                          返回年份
month(date)                         返回月份
day(date)                           返回日期

date_add(date,interval expr type)   返回当前时间加上interval类型 expr数量 type=(year or month or day)类型
datediff(date1,date2)               返回时间差，date1-date2的天数
```

### 流程函数
```
if(value)				
# value==true,return t,else return f

ifnull(value1,value2)		
# value1 is not null,return value1,else return value2

case when [val1] then [res1] ...else[default] end	
# val1==true,return res1,else default

case [expr] when [val1] then [res1] ...else[default] end	
# val1==expr,return res1,else default
```

### exists
```
EXISTS (subquery), 只能写子查询, 用来判断子查询返回是否为空
可以用作增删改查中,如果存在什么则增/删/改/查

# 与子查询返回无关，如果子查询能够返回一条数据则立刻返回true，若子查询无返回，则false
select * from student
where exists(select * from address where student.id=address.a_id);

select * from student
where exists(select * from phone where student.id=phone.p_id);

# 使用双not exists运算符实现除法运算：
-- 除法通用模板
select distinct R1.X	-- 选择R里的X
from R R1
where not exists(	-- 不存在这个X对应的Y值
	select S.Y from S
	where not exists(	-- 这个Y值在S中没有对应的值
		select * from R R2
		where R2.Y=S.Y and R1.X=R2.X	-- 这句比较关键，把R和S联系起来
	)
)
```
