## 多表查询
```
# 关系:
一对一：随便一张表建立外键连接另一张表
一对多：多的表建立外键连接少的表
多对多：创建第三张表，其中两个字段分别建立外键连接两张表
注意：核心思想就是动态表建立外键来连接静态表；通过两张表的某种联系获取结果；
```

### 1. 自然连接：自然连接 NATURAL JOIN [自然连接]
```
# 合并两表间字段名相同条件下值也相同的数据
# 如：
SELECT a.sname,b.cname,d.tname,c.grade
FROM student a NATURAL JOIN score c NATURAL JOIN course b NATURAL JOIN teach d
WHERE cname='数学分析' AND tname='严敏';

# 注意：表中的两个字段有关系时使用；
select 字段列表 from 表1 natural join 表2 on 条件;
# 连接多表
select 字段列表 from 表1 natural join 表2 natural join 表3 on 条件;
# using
using(id) 等效于 where s.id = p.id;
```

### 2. 内连接：笛卡尔积 INNER JOIN [交集]
```
# 笛卡儿积：t1=3,t2=2,则t1*t2=3*2=6,及两个表之间生成的所有种组合
# 需要手动的添加两表间的关系条件，以此才能连接两个表，灵活
# 如：
SELECT a.sname,b.cname,d.tname,c.grade
FROM student a JOIN score c JOIN course b JOIN teach d
on cname='数学分析' AND tname='严敏' AND a.sno = c.sno AND c.cno = b.cno AND d.tno = c.tno;

# 通过条件，s.id=q.id，查询两表id交集
# 注意：条件一般为 子表.外键 = 父表.主键；且可以给每张表起别名；
select 字段列表 from 表1,表2 where 条件;                # 隐式
select 字段列表 from 表1 [inner] join 表2 on 条件;      # 显式
```

### 3. 外连接：笛卡尔积 LEFT/RIGHT OUTER JOIN [外连接表+交集]
```
# 通过条件，s.id=q.id，查询两表id交集，且加上外连接该表的所有
# 注意：左/右外连接可以通过表1,表2的位置互换实现相同的功能；外连接表取全，并在非外连接表上填充null

# 左外连接
select 字段列表 from 表1 left [outer] join 表2 on 条件;

# 右外连接
select 字段列表 from 表2 right [outer] join 表2 on 条件;
```

### 4. 联合查询：将多次查询的结果拼接，结果与全外连接相似 UNION ALL
```
# 只有列数相同的才能拼接
# 注意：分号写在末尾；字段数量与字段类型必须一致；
select * from 表1
union [all]
select * from 表2;

union		去重
union all	不去重
```

### 5. 子查询(嵌套查询)：
```
select * from t1 where column1 = (select column1 from t2);

# 限制范围
in                      包含
not in                  不包含
any/some                部分满足
all                     全部满足
# exists() 存在则返回ture，不存在则返回flase

# 标量子查询
# 例子：查询余华所著的所有书籍信息
# 1.父表writers 中查询name="余华"所对应的id
# 2.子表books 中查询所有id所对应的信息
select * from books where id = (select writers.id from writers where name="余华")

# 列子查询
# 查询比id为2的员工工资都要高(all)/任意一个高(some)/等于(in)/不同(not in)的人的员工信息
select * from emp where salary > all/some/in/not in (select salary from emp where dept_id  = 2);
# 查询不属于科幻片的电影有哪些 
select m.name from movie as m where m.id not in (select m.id from type where type_name='科幻');

# 行子查询
# 一行多列 =；多行多列 in；
select * from emp where (salary,id) = (select salary,managerid from emp where dept_id  = 2);

# 表子查询
# 将查询的结果当作一张表，再与其他表联合查询，获取所需数据
select * from emp where (salary,id) in (select salary,id from emp where dept_id  = 8);
```

```
JOIN ON 和 JOIN WHERE 的区别总结：
    JOIN ON 定义了连接的条件，用于过滤连接中的行；
    WHERE 作用在 连接完成后，用于过滤最终的查询结果集。

# 如下：
SELECT * FROM A 
    JOIN B ON A.id = B.id 
    WHERE A.name = 'Alice';
```
