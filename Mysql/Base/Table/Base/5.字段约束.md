## 字段约束 constraint

### 约束类型
```
not null                    非空约束            非空
unique                      唯一约束            唯一
primary key                 主键约束            非空且唯一
foreign key                 外键约束            引用其他表
check                       检查约束            取值范围
default                     默认约束            默认值
auto_increment              自动增加位数        自动递增
```

### 普通约束的使用
```
# 指定约束
create table student(
id int primary key,			# 中间加
name varchar(20)
);

create table student(
id int，
name varchar(20),
primary key(id)				# 末尾加
);

# 添加约束
alter table 表名 add constraint 别名 约束类型 (字段名);
```

### 外键约束的使用
```
外键的作用：
* 保证数据完整性：确保父表与子表的数据一致
* 避免孤独记录：避免错误的删除子表数据，以致于父表找不到子表数据指向
* 避免无效数据插入：插入一个不存在父表id到子表中，会因外键约束而失败
* 支持级联操作：父表做出删除/修改动作时，子表同步进行

# 指定约束
create table student(
id int,
cs_id int(6) references 父表(主键字段)		# 中间加
);

create table student(
id int，
cs_id int(6),
[constraint] foreign key 子表(子表字段) references 父表(主键字段)		# 末尾加
);

# 添加约束
alter table 子表 add constraint 外键别名 foreign key (子表字段) references 父表(主键字段);
注意：外键约束只能连接父表的主键字段
```

### 规定删除/更新时的外键约束行为
```
规定父表删除/更新的行为，以及对子表的外键中存储的父表id的影响
在添加外键约束的语句末尾添加 [on update 行为] [on delete 行为]
restrict                (默认)限制，在子表数据关联父表的情况下，无法随意修改父表数据
cascade                 级联，当父表数据删除/更新时，子表数据同步删除/修改
set null                设置为null，当父表数据删除/更新时，子表的外键列设置成null
set default             设置为默认值，必须是子表的外键列设有默认值约束
```

### demo
```
drop table if exists movie;
create table movie
(
    movie_id int primary key auto_increment,
    name     varchar(20)
);

drop table if exists length;
create table length
(
    length   int,
    movie_id int,
    foreign key length(movie_id) references movie (movie_id)# 在多对一的关系中，要在多的表中建立外键联系一的表
        on update cascade
        on delete cascade
);

# 插入数据
insert into movie (name)  # 在插入数据时，自增或默认约束的字段可以不写
values ('泰坦尼克号'),
       ('疯狂动物城'),
       ('你的名字');

insert into length
values (120, 1),
       (140, 1),
       (130, 2),
       (180, 3),
       (184, 3);

# 外键测试
# 查询所有电影以及他们所对应的时长,这里需要查询所有的电影，因此是左连接
select movie.name, length.length
from movie
         left join length on length.movie_id = movie.movie_id
where movie.name = '你的名字';

# 1. 避免插入无效数据
insert into length
values (1, 5);
# 插入一个不存在movie_id到length中，会因外键约束而失败

# 2. 保证数据完整性
# 父表是借钱者，子表是被借者。
# 当父表想要删除/修改已经由子表关联的数据时，就像是借钱者借了钱不认账，这是不被允许的。
# 当子表删除/修改与父表关联的数据时，就像是被借者放言不需要借钱者还钱了，这是可以的。
delete from movie
where movie_id = 2; # 删除父表中的数据，不可行
delete from length
where movie_id = 1; # 删除子表中的数据，可行
```