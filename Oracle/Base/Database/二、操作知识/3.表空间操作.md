# 表空间操作

## 一、创建表空间

### 1. 创建操作
```
-- 创建表空间 MOVIE 
CREATE TABLESPACE MOVIE 
    DATAFILE '/opt/oracle/oradata/ORCL/pdbmovie/movie01.dbf' 
    SIZE 200M 
    AUTOEXTEND ON NEXT 5M MAXSIZE UNLIMITED 
    EXTENT MANAGEMENT LOCAL 
    SEGMENT SPACE MANAGEMENT AUTO;

-- 查看所有表空间
SELECT TABLESPACE_NAME, STATUS, CONTENTS FROM DBA_TABLESPACES;

-- 创建用户
CREATE USER MOVIE IDENTIFIED BY 123456 DEFAULT TABLESPACE MOVIE;
GRANT CONNECT,RESOURCE TO MOVIE;
GRANT DBA TO MOVIE;

-- 连接到数据库
connect movie/123456@//127.0.0.1:1521/pdbmovie

-- 修改已有用户指向表空间
ALTER USER MOVIE DEFAULT TABLESPACE MOVIE;
SELECT USERNAME, DEFAULT_TABLESPACE FROM DBA_USERS WHERE USERNAME = 'MOVIE';
```

### 2. 查询操作
```
# 查看表空间：名称、路径、大小、上限、能否自增、每次自增大小
SELECT 
    tablespace_name,
    file_name,
    bytes / 1024 / 1024 AS size_mb,
    maxbytes / 1024 / 1024 AS max_size_mb,
    autoextensible,
    increment_by * (SELECT value FROM v$parameter WHERE name = 'db_block_size') / 1024 / 1024 AS increment_size_mb
FROM 
    dba_data_files
WHERE 
    tablespace_name = 'MOVIE';

# 查看表空间：名称、块大小、拓展方式、管理、状态
SELECT 
    tablespace_name,
    block_size,
    extent_management,
    segment_space_management,
    status
FROM 
    dba_tablespaces
WHERE 
    tablespace_name = 'MOVIE';
```

### 3. 删除操作
```
-- 删除表空间，保留数据文件
DROP TABLESPACE MOVIE INCLUDING CONTENTS;

-- 删除表空间及其数据文件
DROP TABLESPACE MOVIE INCLUDING CONTENTS AND DATAFILES;
```
