# 数据库操作

## 一、连接数据库

### 1.登录操作
```
# sqlplus登录，sqlplus 用户/密码@//IP地址:端口/数据库名登录
sqlplus system/123456@//127.0.0.1:1521/ORCL
```

### 2.切换操作
```
# 查看数据库 CDB
SELECT name, open_mode FROM v$database;

# 查看数据库 PDB
SELECT name, open_mode FROM v$pdbs;

# 开启数据库
alter pluggable database pdbmovie open;

# 关闭数据库
alter pluggable database pdbmovie close;

# 切换数据库，但不切换用户
ALTER SESSION SET CONTAINER=pdbmovie;

# 切换数据库，指定用户登录
connect movieadm/123456@//127.0.0.1:1521/pdbmovie

# 切换 SYSDBCA
connect / as sysdba

# 查看当前数据库
SELECT sys_context('USERENV', 'CON_NAME') AS pdb_name FROM dual;
```

### 3.实例操作
```
# 查看实例 
SELECT instance_name, status FROM v$instance; 

# 启动，可以指定实例，PFILE='/path/to/init.ora' 
STARTUP NOMOUNT;                            创建恢复数据库，不挂载数据库，不访问数据文件、控制文件、日志文件
STARTUP MOUNT;                              恢复修改数据文件，挂载数据库，访问数据文件，控制文件、日志文件关闭
STARTUP OPEN;                               日常操作用户访问，完全开发数据库

# 关闭
SHUTDOWN NORMAL;                            立即关闭，终止事务、断开用户，保证数据一致性
SHUTDOWN TRANSACTIONAL;                     正常关闭，事务完成、用户断开
SHUTDOWN IMMEDIATE;                         优雅关闭，事务完成、用户不断开
SHUTDOWN ABORT;                             强制关闭，终止事务，严重故障、无法关闭时使用
```

## 二、

### 1. 查看信息
```
# 查看数据文件
SELECT name FROM v$datafile;

# 查看表空间 DBF
SELECT TABLESPACE_NAME, STATUS, CONTENTS FROM DBA_TABLESPACES;

# 查看数据表 TBS
SELECT owner, table_name FROM all_tables WHERE tablespace_name = 'USERS';

# 查看用户
SELECT username FROM all_users ORDER BY username;

# SHOW
SHOW user;          # 查看当前用户
```